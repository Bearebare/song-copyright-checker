import streamlit as st
import pandas as pd
import numpy as np
import tempfile
import os

# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
st.set_page_config(
    page_title="‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏û‡∏•‡∏á",
    page_icon="üéµ",
    layout="wide"
)

def analyze_song(audio_data):
    """‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏û‡∏•‡∏á"""
    # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á
    results = {
        'melody_similarity': np.random.uniform(0, 100),
        'rhythm_similarity': np.random.uniform(0, 100),
        'vocal_similarity': np.random.uniform(0, 100),
        'music_similarity': np.random.uniform(0, 100)
    }
    return results

def find_similar_songs():
    """‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ô"""
    similar_songs = []
    num_songs = np.random.randint(1, 4)  # ‡∏™‡∏∏‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢ 1-3 ‡πÄ‡∏û‡∏•‡∏á
    
    thai_artists = ['‡πÄ‡∏ö‡∏¥‡∏£‡πå‡∏î ‡∏ò‡∏á‡πÑ‡∏ä‡∏¢', '‡∏ó‡∏≤‡∏ó‡∏≤ ‡∏¢‡∏±‡∏á', '‡πÅ‡∏™‡∏ï‡∏°‡∏õ‡πå ‡∏≠‡∏†‡∏¥‡∏ß‡∏±‡∏ä‡∏£‡πå', '‡∏≠‡∏±‡∏™‡∏ô‡∏µ-‡∏ß‡∏™‡∏±‡∏ô‡∏ï‡πå', '‡∏õ‡πâ‡∏≤‡∏á ‡∏ô‡∏Ñ‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå']
    song_types = ['‡πÄ‡∏û‡∏•‡∏á‡∏õ‡πá‡∏≠‡∏õ', '‡πÄ‡∏û‡∏•‡∏á‡∏£‡πá‡∏≠‡∏Ñ', '‡πÄ‡∏û‡∏•‡∏á‡∏•‡∏π‡∏Å‡∏ó‡∏∏‡πà‡∏á', '‡πÄ‡∏û‡∏•‡∏á‡∏™‡∏ï‡∏£‡∏¥‡∏á', '‡πÄ‡∏û‡∏•‡∏á‡πÅ‡∏£‡πá‡∏û']
    
    for _ in range(num_songs):
        similar_songs.append({
            'title': f'‡πÄ‡∏û‡∏•‡∏á{np.random.choice(["‡∏£‡∏±‡∏Å", "‡πÄ‡∏´‡∏á‡∏≤", "‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á", "‡πÉ‡∏à", "‡∏ù‡∏±‡∏ô"])}',
            'artist': np.random.choice(thai_artists),
            'type': np.random.choice(song_types),
            'similarity': round(np.random.uniform(70, 99), 2),
            'copyright_owner': f'‡∏Ñ‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏•‡∏á {np.random.choice(["A", "B", "C", "D"])}'
        })
    
    return similar_songs

def main():
    st.title("üéµ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏û‡∏•‡∏á")
    
    # ‡∏™‡∏£‡πâ‡∏≤‡∏á sidebar
    with st.sidebar:
        st.header("üìù ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥")
        st.write("""
        1. ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏•‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        2. ‡∏£‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
        3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
        """)
        
        st.header("‚ö†Ô∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏")
        st.write("""
        - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå MP3 ‡πÅ‡∏•‡∏∞ WAV
        - ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 200MB
        - ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå 1-2 ‡∏ô‡∏≤‡∏ó‡∏µ
        """)
    
    # ‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
    uploaded_file = st.file_uploader("‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏û‡∏•‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì", type=['mp3', 'wav'])
    
    if uploaded_file:
        # ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á
        st.audio(uploaded_file)
        
        if st.button("üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏∞‡πÄ‡∏°‡∏¥‡∏î‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå"):
            with st.spinner('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏û‡∏•‡∏á...'):
                # ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
                analysis = analyze_song(uploaded_file)
                similar_songs = find_similar_songs()
                
                # ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
                st.header("üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå")
                
                # ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Ñ‡∏•‡∏∂‡∏á
                df_analysis = pd.DataFrame({
                    '‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö': ['‡∏ó‡∏≥‡∏ô‡∏≠‡∏á', '‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞', '‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏£‡πâ‡∏≠‡∏á', '‡∏î‡∏ô‡∏ï‡∏£‡∏µ'],
                    '‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå': [
                        analysis['melody_similarity'],
                        analysis['rhythm_similarity'],
                        analysis['vocal_similarity'],
                        analysis['music_similarity']
                    ]
                })
                
                st.bar_chart(df_analysis.set_index('‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö'))
                
                # ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Ñ‡∏•‡∏∂‡∏á
                st.header("üéµ ‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Ñ‡∏•‡∏∂‡∏á")
                
                for song in similar_songs:
                    with st.expander(f"üéµ {song['title']} - {song['artist']} ({song['similarity']}% ‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Ñ‡∏•‡∏∂‡∏á)"):
                        col1, col2 = st.columns(2)
                        
                        with col1:
                            st.write(f"**‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:** {song['type']}")
                            st.write(f"**‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå:** {song['copyright_owner']}")
                        
                        with col2:
                            if song['similarity'] >= 90:
                                st.error("‚ö†Ô∏è ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏∞‡πÄ‡∏°‡∏¥‡∏î‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå")
                            elif song['similarity'] >= 80:
                                st.warning("‚ö° ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Ñ‡∏•‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á")
                            else:
                                st.info("‚ÑπÔ∏è ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Ñ‡∏•‡∏∂‡∏á‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô")

    # ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
    with st.expander("‚ÑπÔ∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"):
        st.write("""
        ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á:
        
        1. **‡∏ó‡∏≥‡∏ô‡∏≠‡∏á** üéº
           - ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÇ‡∏ô‡πâ‡∏ï
           - ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏ó‡∏≥‡∏ô‡∏≠‡∏á
        
        2. **‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞** ü•Å
           - ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á
           - ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞
        
        3. **‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏£‡πâ‡∏≠‡∏á** üé§
           - ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≠‡∏á
           - ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á
        
        4. **‡∏î‡∏ô‡∏ï‡∏£‡∏µ** üé∏
           - ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏á
           - ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ
        """)

if __name__ == "__main__":
    main()
